1. VSCode 단계

배포하고 싶은 리액트 프로젝트의
터미널에서 npm run build 라는 명령어를 입력하면
빌드 폴더가 생성된다.

-------------------------------------------------------------------

2. 도메인 서비스 신청

https://domain.gabia.com/
로 들어가 원하는 도메인을 만들자.

도메인이란? 원범쌤 왈.. ) 차 번호판 같은거지.
나중에 변경이 가능하다.

아무튼 원하는 도메인을 입력해보면 견적이 나오는데
.shop / .store 550원정도 한다.

전문적인 포트폴리오를 만들겠다..? 그럼 돈 더 주고 .com으로 사던가 하자.

아무튼 구입. 결제창에서 

등록기간이 기본 3년이고 비싸게 책정될텐데 1년으로 줄이면 싸게 된다.

1000원 이하는 카드가 안됨.. 그래서 무통입금으로 해결하도록 하자.

가비아 닫지 않은 상태로 아래 단계를 실행하자.

-----------------------------------------------------------------

3. AWS에서 저장소 만들기
 
AWS로 들어가서 루트 사용자 로그인.

AWS에서 S3 검색. 서비스 - S3 클릭.
(https://s3.console.aws.amazon.com/s3/get-started?region=us-east-1)

구글 드라이브 같이 파일을 담아 보관도 가능하고 배포도 가능하고 다양한 역할을 한다.

오측 상단 버킷 만들기 , 이름 지어주고 나머지 기본값.

이 버키의 퍼블릭 액세스 차단 설정 ->  차단 체크 해제.
주의) 현재 설정으로 이 버킷과~~` 알고있음만 체크. 

만들기 하면 저장소가 탄생한다.

만들어진 이름 클릭 - 업로드로 들어간다. 이후, 

Vscode에서 만든 빌드 폴더 내 파일 모두를 드래그하여 추가 및 업로드한다. 

성공했으면 속성탭으로 가서 배포준비를 하자.

속성 탭 가장 아래에 정적 웹 사이트 호스팅 부분으로가 편집 클릭.

여기서 호스팅을 비활성화에서 활성화로 바꿔준다.

그리고 인덱스 문서와 오류문서 - 선택사항 빈칸에

index.html 를 기입한다. 그리고 변경사항 저장.

그러면 가장 밑에 주소가 하나 생기는데 이걸 지금 들어갔을때 403 forbidden이 뜸.

이를 해결하기 위해 위의 권한 탭으로 이동한다.

버킷 정책 오른편의 편집 클릭 - 정책 생성기 클릭 - AWS Policy G

step1
select type of policy - S3 bucket policy를 선택해준다.

step2
effect 에서 allow 체크

principal 에 * 입력. 

actions -> Getobject 체크 .. 1action(s) selected 나오면 맞을것. 

빈칸에 

버킷 정책편집 정책 페이지의 버킷 ARN을 복사 후 

붙여놓고 뒤에 /*  (누구나 접근 가능하다는 뜻)

제너레이트 폴리시 하고 나오는 코드를 복사.

버킷 정책편집 정책에 붙여넣기.

변경사항 저장.

주의!) 한글로 자동번역되어 붙여넣기를 했을때 안될 수 있음. 따라서 영어로 하자.

다시 속성탭으로 가서 맨 아래 링크를 눌러보자!

PROFIT!!!

-------------------------------------------------------------

4. 이제 도메인을 입혀보자.

AWS에서 Route53 검색. 
(https://us-east-1.console.aws.amazon.com/route53/v2/home?region=us-east-1#Dashboard)

도메인을 관리하는 서비스. 

로스팅 영역 생성 클릭.
도메인 이름 빈칸에 가비아에서 샀던 도메인 주소를 복사 붙여넣기. 

나머지 기본값인 채 호스팅 영역 생성 클릭. 

값/ 트래픽 라우팅 대상 부분(보이지않으면 바를 옆으로 밀면 보일것.)을 가비아와 연결해주자.

가비아 로그인 - my가비아 - 이용중인 서비스 - 도메인 

들어가면 자기가 구매한 도메인 내역이 나온다. 구매한 도메인 - 관리 - 네임서버에서 설정으로 들어감.

route53에서 봤던 값/트래픽 라우팅 대상의 4개 링크를 1~4차에 걸쳐 입력을 해주자. 입력하고 보면 각 링크 맨 뒤에 점(.)이 있을거다.

이걸 다 지워주자. 그리고 소유자 인증 후, 적용 클릭. 

------------------------------------------------------------------
배포 주소에 인증서(?) 박기. 
AWS - Certificate Manager 들어가기. 국가를 미국동부(버지니아 북부)인지 확인. 여기서만 가능하기때문에.. 아니라면 해줌.
https://us-east-1.console.aws.amazon.com/acm/home?region=us-east-1#/welcome

인증서 요청 - 퍼블링 인증서 요청 - 다음

도메인 이름 채워주고 추가 클릭.

똑같은 도메인 이름을 적어주되 앞에 별과 점 두개 추가(*.)

나머지 그대로 하고 요청. 결과창에서 새로고침. 하고 나오는 인증서에 들어감.

그리고 중간 우측에 route 53에서 레코드 생성 클릭. 

두개 다 선택 후 레코드 생성. 검증 대기중이 뜬다. 기다려.

AWS - CloudFront 검색.
(https://us-east-1.console.aws.amazon.com/cloudfront/v3/home?region=us-east-1#/welcome)

이거 하면 웹사이트 접근 속도가 빨라진다. 디도스 방어도 알아서 해줌. 보안도..

cloudfront 배포 생성 클릭 후
원본 도메인 클릭해보면 S3에서 만든 도메인이 나올것이다. 선택해주고

등장하는 웹사이트 엔드 포인트사용 클릭.

나머지 기본값으로 두되

뷰어 프로토콜 정책 -> redirect HTTP to HTTPS 이거만 체크해준다.

웹 애플리케이션 방화벽(WAF) ... 디도스 등 악의적인 공격 보호하는 기능인데 유료. 

사용할거면 하고 말람 말자. 실습이니 비활성화로 하자. 

수업중엔 이쯤에서 검증 대기중이던
certicicate manager - > 성공 뜬거 확인. 사람마다 다른데 늦으면 6시간도 걸리고 그렇다. 너무 늦는다 싶으면 기존 대기중 들어가 삭제 후 요청에 들어가 재발급을 반복하다보면 빨리되기도 함..

cloudfront 배포 생성으로 와서 배포생성 버튼. 나온 도메인 링크를 주소창에 찾아가보면 바로는 안나올거 . 시간좀 걸림.

설정 들어가서 대체 도메인 이름 - 항목추가, 구매했던 도메인 주소를 넣어주자. 항목 추가 후
앞에 www.도메인 주소를 넣어주자.

인증서 선택 빈칸에 보면 만들어진것이 있을거다. 클릭. 변경사항 저장.

보고서로 나중에 트래픽이나 주소 . 통계 확인이 가능하다.


라우트 53 이동. 

도메인 등록한거 클릭. 클라우드 프론트에서 대체 도메인 나온걸 등록할것이다.

레코드 생성 클릭. 레코드 이름 별칭 cloudfront 배포에 대한 별칭

배포 선택에 넣어주고 레코드 생성 클릭. www 붙은것도 마찬가지로 추가해준다.